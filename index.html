<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Global Guitar Fret Quiz</title>
  <style>
    body { font-family: 'Segoe UI', sans-serif; background: #1a1a1a; color: #fff; text-align: center; padding: 10px; }
    .container { max-width: 600px; margin: auto; background: #2c2c2c; padding: 20px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }

    /* Fretboard Styling */
    .fretboard { position: relative; width: 100%; height: 180px; background: #3d2b1f; margin: 20px 0; border-radius: 5px; border: 2px solid #5d4037; overflow: hidden; box-shadow: inset 0 0 50px rgba(0,0,0,0.5); }

    /* The Nut (Start of the fretboard) */
    .nut { position: absolute; left: 0; width: 8px; height: 100%; background: #f0f0f0; z-index: 4; border-right: 2px solid #ccc; }

    .string { position: absolute; width: 100%; background: #ddd; z-index: 1; box-shadow: 0 1px 2px rgba(0,0,0,0.5); }
    .fret { position: absolute; width: 2px; height: 100%; background: #999; z-index: 2; }
    .marker { position: absolute; width: 18px; height: 18px; background: #e74c3c; border-radius: 50%; z-index: 5; transform: translate(-50%, -50%); display: none; box-shadow: 0 0 15px #ff4d4d; border: 2px solid #fff; }

    button { padding: 12px 18px; margin: 5px; font-size: 15px; border-radius: 8px; border: none; cursor: pointer; transition: 0.2s; }
    .note-btn { background: #444; color: white; width: 60px; }
    .note-btn:hover { background: #666; transform: scale(1.05); }
    #start-btn { background: #2ecc71; color: white; font-weight: bold; width: 100%; font-size: 18px; margin-top: 10px; }
    select { padding: 10px; border-radius: 8px; background: #444; color: white; border: none; font-size: 16px; width: 100%; margin-bottom: 10px;}

    #leaderboard { margin-top: 30px; text-align: left; background: #333; padding: 15px; border-radius: 10px; border: 1px solid #444; }
    .score-entry { display: flex; justify-content: space-between; border-bottom: 1px solid #444; padding: 8px 0; font-size: 14px; }
    #timer-display { color: #e74c3c; font-size: 28px; font-weight: bold; margin: 10px 0; text-shadow: 0 0 5px rgba(231, 76, 60, 0.3); }
    .label-text { font-size: 12px; color: #aaa; margin-bottom: 5px; display: block; }
  </style>
</head>
<body>

<div class="container">
  <h2>üé∏ Guitar Note Master</h2>
  <p id="player-display">üë§ <strong id="current-username">...</strong></p>

  <div id="setup-area">
    <span class="label-text">Select your challenge time:</span>
    <select id="duration-select">
      <option value="30">30 Seconds (Blitz)</option>
      <option value="60" selected>60 Seconds (Standard)</option>
      <option value="120">120 Seconds (Endurance)</option>
    </select>
    <button id="start-btn">‚ñ∂ START CHALLENGE</button>
  </div>

  <div id="game-area" style="display:none;">
    <div id="timer-display">Time: 60s</div>

    <div class="fretboard" id="fretboard">
        <div class="nut"></div>
        <div id="target-marker" class="marker"></div>
    </div>
    <div style="display: flex; justify-content: space-between; font-size: 11px; color: #888; margin-top: -15px; padding: 0 5px;">
        <span>Nut (Fret 0)</span>
        <span>Fret 12</span>
    </div>

    <p id="question" style="font-weight: bold; font-size: 1.3em; margin-top: 20px;"></p>
    <div id="buttons"></div>
    <p id="result" style="height: 25px; font-weight: bold;"></p>
    <h3>Score: <span id="score-val">0</span></h3>
  </div>

  <div id="leaderboard">
    <h3>üèÜ Global Leaderboard</h3>
    <div id="score-list">Loading scores...</div>
  </div>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
  // TODO: REPLACE THIS WITH YOUR FIREBASE CONFIG
  const firebaseConfig = {
    apiKey: "AIzaSyAraI903rrG8ADWJ47Ew8mn_HDX6yJ_mgw",
    authDomain: "guitarquiz-2204.firebaseapp.com",
    databaseURL: "https://guitarquiz-2204-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "guitarquiz-2204",
    storageBucket: "guitarquiz-2204.firebasestorage.app",
    messagingSenderId: "887259307804",
    appId: "1:887259307804:web:65dfc35e4c4f8467f164d9",
    measurementId: "G-5SFKECVMCX"
    };

const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  // --- UI Setup ---
  const board = document.getElementById('fretboard');

  // Strings: From 6 (Thickest, Top) to 1 (Thinnest, Bottom)
  const stringThicknesses = [3.5, 2.8, 2.2, 1.6, 1.2, 0.8]; // Thick to Thin
  for(let i=0; i<6; i++) {
      let s = document.createElement('div');
      s.className = 'string';
      s.style.height = `${stringThicknesses[i]}px`;
      s.style.top = `${20 + (i * 28)}px`;
      board.appendChild(s);
  }

  // Frets: 1 to 12
  for(let i=1; i<=12; i++) {
      let f = document.createElement('div');
      f.className = 'fret';
      f.style.left = `${(i * 8.33)}%`;
      board.appendChild(f);
  }

  // --- Logic ---
  const strings = [
      {n:6, note:"E", pos:0}, // Top
      {n:5, note:"A", pos:1},
      {n:4, note:"D", pos:2},
      {n:3, note:"G", pos:3},
      {n:2, note:"B", pos:4},
      {n:1, note:"E", pos:5}  // Bottom
  ];
  const notes = ["A","A#","B","C","C#","D","D#","E","F","F#","G","G#"];
  let score = 0, timeLeft = 60, timerActive = false, gameInterval, chosenLimit = 60;
  let correctNote = "";

  let playerName = localStorage.getItem("guitarPlayer") || prompt("Enter your name:") || "Player";
  localStorage.setItem("guitarPlayer", playerName);
  document.getElementById("current-username").textContent = playerName;

  const setupArea = document.getElementById('setup-area');
  const gameArea = document.getElementById('game-area');
  const startBtn = document.getElementById("start-btn");
  const marker = document.getElementById('target-marker');

  function newQuestion() {
    const sIdx = Math.floor(Math.random() * 6);
    const fret = Math.floor(Math.random() * 13);
    const string = strings[sIdx];
    correctNote = notes[(notes.indexOf(string.note) + fret) % 12];

    document.getElementById("question").textContent = `Identify: String ${string.n}, Fret ${fret}`;

    // Move visual marker
    marker.style.display = "block";
    marker.style.top = `${21 + (sIdx * 28)}px`;
    // If fret 0, put it at the nut. Otherwise center in fret space.
    marker.style.left = fret === 0 ? "4px" : `${(fret * 8.33) - 4.16}%`;

    const btns = document.getElementById("buttons");
    btns.innerHTML = "";
    notes.forEach(n => {
      const b = document.createElement("button");
      b.textContent = n; b.className = "note-btn";
      b.onclick = () => {
          if(!timerActive) return;
          if(n === correctNote) {
              score++;
              document.getElementById("result").innerHTML = "<span style='color:#2ecc71'>‚úî CORRECT!</span>";
          } else {
              document.getElementById("result").innerHTML = `<span style='color:#e74c3c'>‚úò WRONG: It was ${correctNote}</span>`;
          }
          document.getElementById("score-val").textContent = score;
          newQuestion();
      };
      btns.appendChild(b);
    });
  }

  function startGame() {
    chosenLimit = document.getElementById('duration-select').value;
    score = 0; timeLeft = chosenLimit; timerActive = true;
    setupArea.style.display = "none";
    gameArea.style.display = "block";
    document.getElementById("score-val").textContent = "0";
    document.getElementById("result").innerHTML = "";
    newQuestion();

    gameInterval = setInterval(() => {
      timeLeft--;
      document.getElementById("timer-display").textContent = `Time: ${timeLeft}s`;
      if (timeLeft <= 0) endGame();
    }, 1000);
  }

  function endGame() {
    clearInterval(gameInterval);
    timerActive = false;
    alert(`Time's up! Final Score: ${score}`);
    updateScoreInDB();
    gameArea.style.display = "none";
    setupArea.style.display = "block";
    startBtn.textContent = "RETRY CHALLENGE üîÑ";
  }

  function updateScoreInDB() {
    set(ref(db, 'scores/' + playerName), {
      username: playerName,
      score: score,
      mode: chosenLimit + "s"
    });
  }

  onValue(ref(db, 'scores'), (snapshot) => {
    const data = snapshot.val();
    const scoreList = document.getElementById("score-list");
    scoreList.innerHTML = "";
    const sorted = Object.values(data || {}).sort((a, b) => b.score - a.score);
    sorted.slice(0, 10).forEach(entry => {
      scoreList.innerHTML += `
        <div class="score-entry">
            <span><strong>${entry.username}</strong> (${entry.mode || '60s'})</span>
            <strong style="color:#2ecc71">${entry.score} pts</strong>
        </div>`;
    });
  });

  startBtn.onclick = startGame;
</script>
</body>
</html>