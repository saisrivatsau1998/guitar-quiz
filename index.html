<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Global Guitar Fret Quiz</title>
  <style>
    body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #1a1a1a; color: #fff; text-align: center; padding: 20px; }
    .container { max-width: 600px; margin: auto; background: #2c2c2c; padding: 20px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
    button { padding: 12px 18px; margin: 6px; font-size: 16px; border-radius: 8px; border: none; cursor: pointer; transition: 0.2s; }
    .note-btn { background: #444; color: white; }
    .note-btn:hover { background: #666; }
    #leaderboard { margin-top: 30px; text-align: left; background: #333; padding: 15px; border-radius: 10px; }
    .score-entry { display: flex; justify-content: space-between; border-bottom: 1px solid #444; padding: 5px 0; }
  </style>
</head>
<body>

<div class="container">
  <h2>üé∏ Guitar Note Quiz</h2>
  <p id="player-display">Playing as: <strong id="current-username">...</strong></p>
  <p id="question">Loading...</p>
  <div id="buttons"></div>
  <p id="result"></p>
  <h3>Your Score: <span id="score">0</span></h3>

  <div id="leaderboard">
    <h3>üèÜ Leaderboard</h3>
    <div id="score-list">Loading scores...</div>
  </div>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

  // TODO: REPLACE THIS WITH YOUR FIREBASE CONFIG
  const firebaseConfig = {
    apiKey: "AIzaSyAraI903rrG8ADWJ47Ew8mn_HDX6yJ_mgw",
    authDomain: "guitarquiz-2204.firebaseapp.com",
    databaseURL: "https://guitarquiz-2204-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "guitarquiz-2204",
    storageBucket: "guitarquiz-2204.firebasestorage.app",
    messagingSenderId: "887259307804",
    appId: "1:887259307804:web:65dfc35e4c4f8467f164d9",
    measurementId: "G-5SFKECVMCX"
    };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  // ... keep your Firebase initialization code here ...

    let score = 0;
    let timeLeft = 60;
    let timerActive = false;
    let gameInterval;

    const startBtn = document.getElementById("start-btn");
    const timerDisplay = document.getElementById("timer-display");

    function startGame() {
    score = 0;
    timeLeft = 60;
    timerActive = true;
    document.getElementById("score").textContent = "0";
    startBtn.style.display = "none";
    timerDisplay.style.display = "block";

    newQuestion(); // Show first question

    gameInterval = setInterval(() => {
        timeLeft--;
        timerDisplay.textContent = `Time: ${timeLeft}s`;

        if (timeLeft <= 0) {
        endGame();
        }
    }, 1000);
    }

    function endGame() {
    clearInterval(gameInterval);
    timerActive = false;
    timerDisplay.style.display = "none";
    startBtn.style.display = "inline-block";
    startBtn.textContent = "RETRY üîÑ";

    document.getElementById("question").textContent = "Time's Up! üèÅ";
    document.getElementById("buttons").innerHTML = "";

    // FINAL SCORE SAVE
    updateScoreInDB();
    alert(`Game Over! You scored ${score} points.`);
    }

    // Update your checkAnswer logic to only work if timerActive is true
    function checkAnswer(answer) {
    if (!timerActive) return;

    if (answer === correctNote) {
        score++;
        document.getElementById("result").textContent = "‚úÖ Correct!";
    } else {
        document.getElementById("result").textContent = `‚ùå Wrong: ${correctNote}`;
    }
    document.getElementById("score").textContent = score;
    newQuestion();
    }

    startBtn.onclick = startGame;
  // --- Database Logic ---
  function updateScoreInDB() {
    set(ref(db, 'scores/' + playerName), {
      username: playerName,
      score: score
    });
  }

  // Listen for Leaderboard updates
  onValue(ref(db, 'scores'), (snapshot) => {
    const data = snapshot.val();
    const scoreList = document.getElementById("score-list");
    scoreList.innerHTML = "";

    // Sort and display
    const sorted = Object.values(data || {}).sort((a, b) => b.score - a.score);
    sorted.forEach(entry => {
      scoreList.innerHTML += `<div class="score-entry"><span>${entry.username}</span> <strong>${entry.score}</strong></div>`;
    });
  });

  newQuestion();
</script>
</body>
</html>